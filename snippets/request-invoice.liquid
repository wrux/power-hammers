{% if product.metafields.custom.disable_buy == true %}
  {{ 'request-invoice.css' | asset_url | stylesheet_tag }}

  <div id="requestInvoice">
    {%- form 'contact',
        id: 'requestInvoiceForm',
        class: 'request-invoice-form'
    -%}
      <h3><strong>Request an invoice</strong></h3>

      <p>If you need to request an invoice for your accounting requirements, please use this form below.</p>

      <!-- Capture product name -->
      <input type="hidden" name="contact[product]" value="{{ product.title }}">

      <label for="your-email">Your email:</label>
      <input id="your-email"
             name="contact[email]"
             type="email"
             placeholder="Your email"
             required>

      <button type="submit" class="product-form__submit button button--full-width button--secondary">
        Request an invoice
      </button>
    {%- endform -%}
  </div>

  <!-- JavaScript to handle homepage redirect and show success message -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const params = new URLSearchParams(window.location.search);

      // If the contact form was just submitted
      if (params.get("contact_posted") === "true") {
        // Redirect back to the same product page with anchor and success flag
        const redirectUrl = "{{ product.url }}#requestInvoice?success=true";
        window.history.replaceState({}, "", redirectUrl);

        // Show success message inline
        const formDiv = document.getElementById("requestInvoice");
        if (formDiv) {
          const successMsg = document.createElement("p");
          successMsg.className = "request-invoice-success";
          successMsg.textContent = "✅ Your invoice request has been sent. We’ll get back to you shortly.";
          formDiv.prepend(successMsg);
        }
      }
    });
  </script>
{% endif %}